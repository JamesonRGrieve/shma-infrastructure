---
container_ip: "{{ mariadb_ip }}"
container:
  vmid: "{{ mariadb_container_id }}"
  hostname: "{{ mariadb_hostname }}"
  ostemplate: "{{ proxmox_template | default('local:vztmpl/ubuntu-24.04-standard_24.04-2_amd64.tar.zst') }}"
  disk: "{{ mariadb_storage_gb }}"
  cores: "{{ mariadb_cores }}"
  memory: "{{ mariadb_memory }}"
  swap: "{{ mariadb_memory }}"
  netif:
    net0: "name=eth0,bridge=vmbr0,ip={{ mariadb_ip }}/24,gw={{ gateway }}"
  onboot: yes
  unprivileged: yes
  features: "nesting=1,keyctl=1"

setup:
  packages:
    - mariadb-server
    - mariadb-client
    - python3-pymysql

  config:
    - path: /etc/mysql/mariadb.conf.d/99-custom.cnf
      content: |
        [mysqld]
        bind-address = {{ mariadb_bind_address | default(container_ip) }}
        max_connections = 200

  services:
    - name: mariadb
      enabled: true
      state: started
