service_id: sample-service
service_name: sample-service
service_unit_name: sample-service
service_image: docker.io/library/nginx@sha256:2ed85f18cb2c6b49e191bcb6bf12c0c07d63f3937a05d9f5234170d4f8df5c94
version: "1.27.0"
service_ip: 10.23.45.50
service_ports:
  - target: 8080
    published: 8080
    host_ip: 10.23.45.50
service_env:
  - name: APP_MODE
    value: production
  - name: APP_FEATURE_FLAG
    value: "true"
needs_container_runtime: true
service_volumes:
  - name: config
    host_path: /srv/sample-service/config
    host_path_type: DirectoryOrCreate
    target: /etc/sample-service
service_packages:
  - nginx
  - curl
service_files:
  - path: /etc/sample-service/runtime.env
    mode: '0640'
    content: "{{ service_env | render_env_file }}"
service_services:
  - name: sample-service
    enabled: true
    state: started
service_commands:
  - /usr/bin/true
service_resources:
  memory_mb: 512
  cpu_cores: 1
  connections_per_second: 200
service_namespace: sample
service_replicas: 1
service_storage_gb: 5
service_gateway: 10.23.45.1
service_container:
  vmid: 200
  hostname: sample-service
  ostemplate: local:vztmpl/ubuntu-24.04-standard_24.04-2_amd64.tar.zst
  disk: 5
  cores: 1
  memory: 512
  swap: 512
  bridge: vmbr0
  cidr: 24
  gateway: 10.23.45.1
  interface: eth0
  onboot: yes
  unprivileged: yes
exports:
  env:
    - name: SAMPLE_SERVICE_URL
      value: https://sample-service.internal
      description: Base URL for dependent services
    - name: SAMPLE_SERVICE_PORT
      value: "8080"
mounts:
  persistent_volumes:
    - name: config
      path: /etc/sample-service
  ephemeral_mounts:
    - name: runtime-run
      path: /run/sample-service
      medium: Memory
      size: 64Mi
      mode: '0755'
    - name: runtime-tmp
      path: /tmp/sample-service
      size: 64Mi
health:
  cmd:
    - /usr/bin/env
    - bash
    - -c
    - "curl --fail --silent http://127.0.0.1:8080/healthz"
  interval: 10s
  timeout: 5s
  retries: 3
runtime_templates:
  proxmox: ../templates/proxmox.yml.j2
  docker: ../templates/docker.yml.j2
  podman: ../templates/podman.yml.j2
  kubernetes: ../templates/kubernetes.yml.j2
  baremetal: ../templates/baremetal.yml.j2
secrets:
  shred_after_apply: true
  rotation_timestamp: "2024-08-20T12:34:56Z"
  items:
    - name: SAMPLE_SERVICE_TOKEN
      type: env
      value: "{{ vault_sample_service_token }}"
    - name: tls-cert
      type: file
      content: "{{ vault_sample_service_tls_cert }}"
      target: /etc/sample-service/certs/tls.crt
      mode: '0400'
