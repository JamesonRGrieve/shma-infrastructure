service_id: secure-service
service_name: secure-service
service_image: registry.example.com/secure/app@sha256:0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
service_ip: &service_ip 203.0.113.10
service_ports:
  - target: 8443
    published: 8443
    host_ip: *service_ip
service_env:
  - name: APP_MODE
    value: secure
service_volumes:
  - name: tls
    source: secure-tls
    target: /etc/ssl/private
  - name: secrets
    host_path: /var/lib/secure
    host_path_type: DirectoryOrCreate
    target: /var/lib/secure
service_packages:
  - curl
service_files: []
service_services: []
service_commands: []
service_resources:
  memory_mb: 256
  cpu_cores: 1
service_namespace: secure
service_replicas: 2
service_storage_gb: 4
runtime_templates:
  proxmox: ../templates/proxmox.yml.j2
  docker: ../templates/docker.yml.j2
  podman: ../templates/podman.yml.j2
  kubernetes: ../templates/kubernetes.yml.j2
  baremetal: ../templates/baremetal.yml.j2
exports:
  env:
    - name: SECURE_URL
      value: https://secure.local
mounts:
  persistent_volumes:
    - name: secrets
      path: /var/lib/secure
  ephemeral_mounts:
    - name: runtime-run
      path: /run/secure
      medium: Memory
      size: 96Mi
health:
  cmd:
    - /usr/bin/env
    - bash
    - -c
    - "curl --fail --silent --insecure https://127.0.0.1:8443/healthz"
needs_container_runtime: true
secrets:
  shred_after_apply: true
  items:
    - name: SECURE_TOKEN
      type: env
      value: "{{ vault_secure_service_token }}"
    - name: tls-key
      type: file
      content: "{{ vault_secure_service_tls_key }}"
      target: /etc/ssl/private/tls.key
      mode: '0400'
