service_id: sample-service
service_name: sample-service
service_unit_name: sample-service
service_image: docker.io/library/nginx:1.27
version: "1.27"
service_ip: 192.0.2.50
service_ports:
  - target: 8080
    published: 8080
    host_ip: 192.0.2.50
service_env:
  - name: APP_MODE
    value: production
  - name: APP_FEATURE_FLAG
    value: "true"
needs_container_runtime: true
service_volumes:
  - name: config
    source: sample-service-config
    target: /etc/sample-service
    driver: local
service_packages:
  - nginx
service_files:
  - path: /etc/sample-service/runtime.env
    mode: '0640'
    content: |
      APP_MODE=production
      APP_FEATURE_FLAG=true
service_services:
  - name: sample-service
    enabled: true
    state: started
service_commands:
  - /usr/bin/true
service_resources:
  memory_mb: 512
  cpu_cores: 1
service_namespace: sample
service_replicas: 1
service_storage_gb: 5
service_gateway: 192.0.2.1
service_container:
  vmid: 200
  hostname: sample-service
  ostemplate: local:vztmpl/ubuntu-24.04-standard_24.04-2_amd64.tar.zst
  disk: 5
  cores: 1
  memory: 512
  swap: 512
  bridge: vmbr0
  cidr: 24
  gateway: 192.0.2.1
  interface: eth0
  onboot: yes
  unprivileged: yes
  features: nesting=1,keyctl=1
exports:
  env:
    - name: SAMPLE_SERVICE_URL
      value: https://sample-service.internal
      description: Base URL for dependent services
    - name: SAMPLE_SERVICE_PORT
      value: "8080"
storage:
  - name: config
    path: /etc/sample-service
health:
  cmd:
    - /bin/sh
    - -c
    - "exit 0"
  interval: 10s
  timeout: 5s
  retries: 3
runtime_templates:
  proxmox: templates/proxmox.yml.j2
  docker: templates/docker.yml.j2
  podman: templates/podman.yml.j2
  kubernetes: templates/kubernetes.yml.j2
  baremetal: templates/baremetal.yml.j2
secrets:
  shred_after_apply: false
  env:
    - name: SAMPLE_SERVICE_TOKEN
      value: super-secret-token
  files:
    - name: tls-cert
      value: "-----BEGIN CERTIFICATE-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtestcertificate\n-----END CERTIFICATE-----"
      target: /etc/sample-service/certs/tls.crt
      mode: '0400'
